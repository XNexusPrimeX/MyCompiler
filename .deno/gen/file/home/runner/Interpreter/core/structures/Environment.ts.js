import InterpreterError from "../../errors/mod.ts";
export class Environment {
    parent;
    variables;
    constructor(parentENV) {
        this.parent = parentENV;
        this.variables = new Map();
    }
    declareVar(varname, value) {
        if (this.variables.has(varname)) {
            throw new InterpreterError('IdentifierError', `Identifier "${varname}" has already been declared`);
        }
        this.variables.set(varname, value);
        return value;
    }
    assignVar(varname, value) {
        const env = this.resolve(varname);
        env.variables.set(varname, value);
        return value;
    }
    lookupVar(varname) {
        const env = this.resolve(varname);
        return env.variables.get(varname);
    }
    resolve(varname) {
        if (this.variables.has(varname)) {
            return this;
        }
        if (this.parent == undefined) {
            throw new InterpreterError('IdentifierError', `"${varname}" is not defined`);
        }
        return this.parent.resolve(varname);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW52aXJvbm1lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJFbnZpcm9ubWVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLGdCQUFnQixNQUFNLHFCQUFxQixDQUFDO0FBR25ELE1BQU0sT0FBTyxXQUFXO0lBQ2QsTUFBTSxDQUFlO0lBQ3JCLFNBQVMsQ0FBMEI7SUFFM0MsWUFBWSxTQUF1QjtRQUNqQyxJQUFJLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQztRQUN4QixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7SUFDN0IsQ0FBQztJQUVNLFVBQVUsQ0FBQyxPQUFlLEVBQUUsS0FBaUI7UUFDbEQsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUMvQixNQUFNLElBQUksZ0JBQWdCLENBQUMsaUJBQWlCLEVBQUUsZUFBZSxPQUFPLDZCQUE2QixDQUFDLENBQUM7U0FDcEc7UUFFRCxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbkMsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRU0sU0FBUyxDQUFDLE9BQWUsRUFBRSxLQUFpQjtRQUNqRCxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2xDLEdBQUcsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNsQyxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFTSxTQUFTLENBQUMsT0FBZTtRQUM5QixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2xDLE9BQU8sR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFlLENBQUM7SUFDbEQsQ0FBQztJQUVNLE9BQU8sQ0FBQyxPQUFlO1FBQzVCLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDL0IsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUVELElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxTQUFTLEVBQUU7WUFDNUIsTUFBTSxJQUFJLGdCQUFnQixDQUFDLGlCQUFpQixFQUFFLElBQUksT0FBTyxrQkFBa0IsQ0FBQyxDQUFDO1NBQzlFO1FBRUQsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN0QyxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSW50ZXJwcmV0ZXJFcnJvciBmcm9tIFwiLi4vLi4vZXJyb3JzL21vZC50c1wiO1xuaW1wb3J0IHsgUnVudGltZVZhbCB9IGZyb20gXCIuLi9zdGFnZXMvMDMtUnVudGltZS50c1wiO1xuXG5leHBvcnQgY2xhc3MgRW52aXJvbm1lbnQge1xuICBwcml2YXRlIHBhcmVudD86IEVudmlyb25tZW50O1xuICBwcml2YXRlIHZhcmlhYmxlczogTWFwPHN0cmluZywgUnVudGltZVZhbD47XG5cbiAgY29uc3RydWN0b3IocGFyZW50RU5WPzogRW52aXJvbm1lbnQpIHtcbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudEVOVjtcbiAgICB0aGlzLnZhcmlhYmxlcyA9IG5ldyBNYXAoKTtcbiAgfVxuXG4gIHB1YmxpYyBkZWNsYXJlVmFyKHZhcm5hbWU6IHN0cmluZywgdmFsdWU6IFJ1bnRpbWVWYWwpOiBSdW50aW1lVmFsIHtcbiAgICBpZiAodGhpcy52YXJpYWJsZXMuaGFzKHZhcm5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJwcmV0ZXJFcnJvcignSWRlbnRpZmllckVycm9yJywgYElkZW50aWZpZXIgXCIke3Zhcm5hbWV9XCIgaGFzIGFscmVhZHkgYmVlbiBkZWNsYXJlZGApO1xuICAgIH1cblxuICAgIHRoaXMudmFyaWFibGVzLnNldCh2YXJuYW1lLCB2YWx1ZSk7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgcHVibGljIGFzc2lnblZhcih2YXJuYW1lOiBzdHJpbmcsIHZhbHVlOiBSdW50aW1lVmFsKTogUnVudGltZVZhbCB7XG4gICAgY29uc3QgZW52ID0gdGhpcy5yZXNvbHZlKHZhcm5hbWUpO1xuICAgIGVudi52YXJpYWJsZXMuc2V0KHZhcm5hbWUsIHZhbHVlKTtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICBwdWJsaWMgbG9va3VwVmFyKHZhcm5hbWU6IHN0cmluZyk6IFJ1bnRpbWVWYWwge1xuICAgIGNvbnN0IGVudiA9IHRoaXMucmVzb2x2ZSh2YXJuYW1lKTtcbiAgICByZXR1cm4gZW52LnZhcmlhYmxlcy5nZXQodmFybmFtZSkgYXMgUnVudGltZVZhbDtcbiAgfVxuXG4gIHB1YmxpYyByZXNvbHZlKHZhcm5hbWU6IHN0cmluZyk6IEVudmlyb25tZW50IHtcbiAgICBpZiAodGhpcy52YXJpYWJsZXMuaGFzKHZhcm5hbWUpKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBpZiAodGhpcy5wYXJlbnQgPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJwcmV0ZXJFcnJvcignSWRlbnRpZmllckVycm9yJywgYFwiJHt2YXJuYW1lfVwiIGlzIG5vdCBkZWZpbmVkYCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMucGFyZW50LnJlc29sdmUodmFybmFtZSk7XG4gIH1cbn0iXX0=