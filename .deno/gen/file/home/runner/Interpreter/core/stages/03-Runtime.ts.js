import InterpreterError from "@errors";
import { comparativeOperators, multiplicitateOperators } from "../constants/Operators.ts";
export class Runtime {
    returns;
    evaluate(astNode, env) {
        switch (astNode.kind) {
            case 'Identifier': {
                return env.lookupVar(astNode.symbol);
            }
            case 'NumberLiteral': {
                return {
                    type: 'number',
                    value: astNode.value
                };
            }
            case 'StringLiteral': {
                return {
                    type: 'string',
                    value: astNode.value
                };
            }
            case 'BooleanLiteral': {
                return {
                    type: 'boolean',
                    value: astNode.value
                };
            }
            case "NullLiteral": {
                return { value: "null", type: "null" };
            }
            case "AssignExpression": {
                const variable = astNode;
                env.declareVar(variable.symbol, this.evaluate(variable.value, env));
                return { type: 'null', value: 'null' };
            }
            case "BinaryExpression": {
                const binOperation = astNode;
                console.log('astNode', astNode);
                const lhs = this.evaluate(binOperation.left, env);
                const rhs = this.evaluate(binOperation.right, env);
                return this.evalBinaryExpression(lhs, rhs, binOperation.operator);
            }
            case "Program": {
                let lastEvaluated = { type: "null", value: "null" };
                for (const statement of astNode.body) {
                    lastEvaluated = this.evaluate(statement, env);
                }
                return lastEvaluated;
            }
            default: {
                throw new InterpreterError('RuntimeError', astNode.kind);
            }
        }
    }
    evalBinaryExpression(lhs, rhs, operator) {
        let result;
        if (!comparativeOperators.includes(operator)) {
            if (lhs.type !== "number" && rhs.type !== "number") {
                throw new InterpreterError('TypeError');
            }
        }
        if (multiplicitateOperators.includes(operator)) {
            if ([lhs.value, rhs.value].includes(0)) {
                throw new InterpreterError('ZeroDivisionError');
            }
        }
        result = eval(`${lhs.value} ${operator} ${rhs.value}`);
        return {
            type: 'number',
            value: result
        };
    }
    constructor(astNode, env) {
        this.returns = this.evaluate(astNode, env);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMDMtUnVudGltZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIjAzLVJ1bnRpbWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxnQkFBZ0IsTUFBTSxTQUFTLENBQUM7QUFFdkMsT0FBTyxFQUFFLG9CQUFvQixFQUFFLHVCQUF1QixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFZMUYsTUFBTSxPQUFPLE9BQU87SUFDaEIsT0FBTyxDQUFDO0lBRUEsUUFBUSxDQUFDLE9BQWtCLEVBQUUsR0FBZ0I7UUFDakQsUUFBTyxPQUFPLENBQUMsSUFBSSxFQUFFO1lBQ2pCLEtBQUssWUFBWSxDQUFDLENBQUM7Z0JBQ2YsT0FBTyxHQUFHLENBQUMsU0FBUyxDQUFFLE9BQXNCLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDeEQ7WUFDRCxLQUFLLGVBQWUsQ0FBQyxDQUFDO2dCQUNsQixPQUFPO29CQUNILElBQUksRUFBRSxRQUFRO29CQUNkLEtBQUssRUFBRyxPQUF5QixDQUFDLEtBQUs7aUJBQzFDLENBQUM7YUFDTDtZQUNELEtBQUssZUFBZSxDQUFDLENBQUM7Z0JBQ2xCLE9BQU87b0JBQ0gsSUFBSSxFQUFFLFFBQVE7b0JBQ2QsS0FBSyxFQUFHLE9BQXlCLENBQUMsS0FBSztpQkFDMUMsQ0FBQTthQUNKO1lBQ0QsS0FBSyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUNuQixPQUFPO29CQUNILElBQUksRUFBRSxTQUFTO29CQUNmLEtBQUssRUFBRyxPQUEwQixDQUFDLEtBQUs7aUJBQzNDLENBQUE7YUFDSjtZQUNELEtBQUssYUFBYSxDQUFDLENBQUM7Z0JBQ2hCLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsQ0FBQzthQUMxQztZQUNELEtBQUssa0JBQWtCLENBQUMsQ0FBQztnQkFDckIsTUFBTSxRQUFRLEdBQUcsT0FBMkIsQ0FBQztnQkFFN0MsR0FBRyxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUVwRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUE7YUFDekM7WUFDRCxLQUFLLGtCQUFrQixDQUFDLENBQUM7Z0JBQ3JCLE1BQU0sWUFBWSxHQUFHLE9BQTJCLENBQUM7Z0JBQzFELE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFBO2dCQUV0QixNQUFNLEdBQUcsR0FBYyxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBQzdELE1BQU0sR0FBRyxHQUFjLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFFOUQsT0FBTyxJQUFJLENBQUMsb0JBQW9CLENBQzlCLEdBQUcsRUFDSCxHQUFHLEVBQ0gsWUFBWSxDQUFDLFFBQVEsQ0FDdEIsQ0FBQzthQUNMO1lBQ0QsS0FBSyxTQUFTLENBQUMsQ0FBQztnQkFDWixJQUFJLGFBQWEsR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxDQUFDO2dCQUNwRCxLQUFLLE1BQU0sU0FBUyxJQUFLLE9BQW1CLENBQUMsSUFBSSxFQUFFO29CQUMvQyxhQUFhLEdBQVEsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLENBQUM7aUJBQ3REO2dCQUNELE9BQU8sYUFBYSxDQUFDO2FBQ3hCO1lBQ0QsT0FBTyxDQUFDLENBQUM7Z0JBQ0wsTUFBTSxJQUFJLGdCQUFnQixDQUFDLGNBQWMsRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDNUQ7U0FDSjtJQUNMLENBQUM7SUFFTyxvQkFBb0IsQ0FBQyxHQUFlLEVBQUUsR0FBZSxFQUFFLFFBQWdCO1FBQzNFLElBQUksTUFBYyxDQUFDO1FBRW5CLElBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDekMsSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLFFBQVEsSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLFFBQVEsRUFBRTtnQkFDaEQsTUFBTSxJQUFJLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDO2FBQzNDO1NBQ0o7UUFFRCxJQUFHLHVCQUF1QixDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUMzQyxJQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUNuQyxNQUFNLElBQUksZ0JBQWdCLENBQUMsbUJBQW1CLENBQUMsQ0FBQzthQUNuRDtTQUNKO1FBRUQsTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxLQUFLLElBQUksUUFBUSxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBRXZELE9BQU87WUFDSCxJQUFJLEVBQUUsUUFBUTtZQUNkLEtBQUssRUFBRSxNQUFNO1NBQ0YsQ0FBQTtJQUNuQixDQUFDO0lBRUQsWUFBWSxPQUFrQixFQUFFLEdBQWdCO1FBQzVDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDL0MsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXNzaWduRXhwcmVzc2lvbiwgQmluYXJ5RXhwcmVzc2lvbiwgQm9vbGVhbkxpdGVyYWwsIElkZW50aWZpZXIsIE51bWJlckxpdGVyYWwsIFN0cmluZ0xpdGVyYWwgfSBmcm9tIFwiQGV4cHJlc3Npb25zXCI7XG5pbXBvcnQgeyBFbnZpcm9ubWVudCwgU3RhdGVtZW50IH0gZnJvbSBcIkBzdHJ1Y3R1cmVzXCI7XG5pbXBvcnQgSW50ZXJwcmV0ZXJFcnJvciBmcm9tIFwiQGVycm9yc1wiO1xuaW1wb3J0IHsgUHJvZ3JhbSB9IGZyb20gXCIuLzAyLVBhcnNlci50c1wiO1xuaW1wb3J0IHsgY29tcGFyYXRpdmVPcGVyYXRvcnMsIG11bHRpcGxpY2l0YXRlT3BlcmF0b3JzIH0gZnJvbSBcIi4uL2NvbnN0YW50cy9PcGVyYXRvcnMudHNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBSdW50aW1lVmFsIHtcbiAgICB0eXBlOiBzdHJpbmcsXG4gICAgdmFsdWU6IGFueVxufVxuXG5pbnRlcmZhY2UgTnVtYmVyVmFsIGV4dGVuZHMgUnVudGltZVZhbCB7XG4gICAgdHlwZTogJ251bWJlcicsXG4gICAgdmFsdWU6IG51bWJlclxufSBcblxuZXhwb3J0IGNsYXNzIFJ1bnRpbWUge1xuICAgIHJldHVybnM7XG5cbiAgICBwcml2YXRlIGV2YWx1YXRlKGFzdE5vZGU6IFN0YXRlbWVudCwgZW52OiBFbnZpcm9ubWVudCk6IFJ1bnRpbWVWYWwge1xuICAgICAgICBzd2l0Y2goYXN0Tm9kZS5raW5kKSB7XG4gICAgICAgICAgICBjYXNlICdJZGVudGlmaWVyJzoge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbnYubG9va3VwVmFyKChhc3ROb2RlIGFzIElkZW50aWZpZXIpLnN5bWJvbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICdOdW1iZXJMaXRlcmFsJzoge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogKGFzdE5vZGUgYXMgTnVtYmVyTGl0ZXJhbCkudmFsdWUgXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgJ1N0cmluZ0xpdGVyYWwnOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAoYXN0Tm9kZSBhcyBTdHJpbmdMaXRlcmFsKS52YWx1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgJ0Jvb2xlYW5MaXRlcmFsJzoge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IChhc3ROb2RlIGFzIEJvb2xlYW5MaXRlcmFsKS52YWx1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgXCJOdWxsTGl0ZXJhbFwiOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IFwibnVsbFwiLCB0eXBlOiBcIm51bGxcIiB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcIkFzc2lnbkV4cHJlc3Npb25cIjoge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhcmlhYmxlID0gYXN0Tm9kZSBhcyBBc3NpZ25FeHByZXNzaW9uO1xuXG4gICAgICAgICAgICAgICAgZW52LmRlY2xhcmVWYXIodmFyaWFibGUuc3ltYm9sLCB0aGlzLmV2YWx1YXRlKHZhcmlhYmxlLnZhbHVlLCBlbnYpKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB7IHR5cGU6ICdudWxsJywgdmFsdWU6ICdudWxsJyB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwiQmluYXJ5RXhwcmVzc2lvblwiOiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYmluT3BlcmF0aW9uID0gYXN0Tm9kZSBhcyBCaW5hcnlFeHByZXNzaW9uO1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZygnYXN0Tm9kZScsIGFzdE5vZGUpXG5cbiAgICAgICAgICAgICAgICBjb25zdCBsaHMgPSA8TnVtYmVyVmFsPnRoaXMuZXZhbHVhdGUoYmluT3BlcmF0aW9uLmxlZnQsIGVudik7XG4gICAgICAgICAgICAgICAgY29uc3QgcmhzID0gPE51bWJlclZhbD50aGlzLmV2YWx1YXRlKGJpbk9wZXJhdGlvbi5yaWdodCwgZW52KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ldmFsQmluYXJ5RXhwcmVzc2lvbihcbiAgICAgICAgICAgICAgICAgIGxocyxcbiAgICAgICAgICAgICAgICAgIHJocyxcbiAgICAgICAgICAgICAgICAgIGJpbk9wZXJhdGlvbi5vcGVyYXRvcixcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcIlByb2dyYW1cIjoge1xuICAgICAgICAgICAgICAgIGxldCBsYXN0RXZhbHVhdGVkID0geyB0eXBlOiBcIm51bGxcIiwgdmFsdWU6IFwibnVsbFwiIH07XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBzdGF0ZW1lbnQgb2YgKGFzdE5vZGUgYXMgUHJvZ3JhbSkuYm9keSkge1xuICAgICAgICAgICAgICAgICAgICBsYXN0RXZhbHVhdGVkID0gPGFueT50aGlzLmV2YWx1YXRlKHN0YXRlbWVudCwgZW52KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxhc3RFdmFsdWF0ZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVycHJldGVyRXJyb3IoJ1J1bnRpbWVFcnJvcicsIGFzdE5vZGUua2luZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGV2YWxCaW5hcnlFeHByZXNzaW9uKGxoczogUnVudGltZVZhbCwgcmhzOiBSdW50aW1lVmFsLCBvcGVyYXRvcjogc3RyaW5nKSB7XG4gICAgICAgIGxldCByZXN1bHQ6IG51bWJlcjtcblxuICAgICAgICBpZighY29tcGFyYXRpdmVPcGVyYXRvcnMuaW5jbHVkZXMob3BlcmF0b3IpKSB7XG4gICAgICAgICAgICBpZiAobGhzLnR5cGUgIT09IFwibnVtYmVyXCIgJiYgcmhzLnR5cGUgIT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJwcmV0ZXJFcnJvcignVHlwZUVycm9yJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZihtdWx0aXBsaWNpdGF0ZU9wZXJhdG9ycy5pbmNsdWRlcyhvcGVyYXRvcikpIHtcbiAgICAgICAgICAgIGlmKFtsaHMudmFsdWUsIHJocy52YWx1ZV0uaW5jbHVkZXMoMCkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJwcmV0ZXJFcnJvcignWmVyb0RpdmlzaW9uRXJyb3InKTsgXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXN1bHQgPSBldmFsKGAke2xocy52YWx1ZX0gJHtvcGVyYXRvcn0gJHtyaHMudmFsdWV9YCk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgdmFsdWU6IHJlc3VsdFxuICAgICAgICB9IGFzIFJ1bnRpbWVWYWxcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcihhc3ROb2RlOiBTdGF0ZW1lbnQsIGVudjogRW52aXJvbm1lbnQpIHtcbiAgICAgICAgdGhpcy5yZXR1cm5zID0gdGhpcy5ldmFsdWF0ZShhc3ROb2RlLCBlbnYpO1xuICAgIH1cbn0iXX0=